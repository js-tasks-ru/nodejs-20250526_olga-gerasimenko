# Задание: Тестирование CRUD-приложения для управления задачами

В этом задании вы будете работать с готовым CRUD-приложением для управления задачами, написанным на NestJS. Ваша
задача — разработать набор тестов (модульных и интеграционных) для проверки корректности работы сервиса.

## Описание приложения

Приложение представляет собой простой сервис для управления задачами со следующими возможностями:

- Создание задачи
- Получение списка всех задач
- Получение конкретной задачи по ID
- Обновление существующей задачи
- Удаление задачи

Структура приложения:

- `AppModule` - корневой модуль приложения
- `TasksModule` - модуль для работы с задачами
- `TasksController` - контроллер с API-эндпоинтами
- `TasksService` - сервис с бизнес-логикой
- `Task` - сущность задачи для базы данных

## Задание

Ваша задача состоит в написании:

1. **Модульных тестов** для `TasksService`
2. **Интеграционных (e2e) тестов** для API-эндпоинтов в `TasksController`

### Часть 1: Модульные тесты для TasksService

Напишите модульные тесты для всех методов `TasksService`. В тестах необходимо проверить:

1. **create** - корректное создание новой задачи и сохранение её в репозитории
2. **findAll** - получение списка всех задач
3. **findOne** - получение задачи по ID и проверка генерации исключения при отсутствии задачи
4. **update** - корректное обновление существующей задачи
5. **remove** - корректное удаление задачи

Для написания модульных тестов используйте подход с мокированием репозитория.

### Часть 2: Интеграционные (e2e) тесты

Напишите e2e тесты для всех эндпоинтов API:

1. **POST /tasks** - создание новой задачи
2. **GET /tasks** - получение всех задач
3. **GET /tasks/:id** - получение задачи по ID
4. **PATCH /tasks/:id** - обновление задачи
5. **DELETE /tasks/:id** - удаление задачи

Для написания e2e тестов используйте реальную базу данных (встроенную SQLite в памяти) и проверяйте фактическое наличие данных в репозитории.

## Требования к реализации

### Модульные тесты (tasks.service.spec.ts)

- Используйте `TestingModule` из `@nestjs/testing`
- Создайте мок для `Repository<Task>` с помощью Jest
- Протестируйте все пять методов сервиса
- Проверьте обработку ошибок (например, `NotFoundException` при запросе несуществующей задачи)

### E2E тесты (tasks.e2e-spec.ts)

- Используйте библиотеку `supertest` для отправки HTTP-запросов
- Настройте тестовое приложение с реальными зависимостями
- Перед каждым тестом очищайте и заполняйте базу данных тестовыми данными
- Проверяйте HTTP-статусы ответов и возвращаемые данные
- Проверяйте фактическое состояние базы данных после выполнения операций

## Файлы для реализации

1. `src/tasks/__tests__/tasks.unit.test.ts` - модульные тесты для сервиса
2. `src/tasks/__tests__/tasks.e2e.test.ts` - e2e тесты для API

## Подсказки

1. Для модульных тестов используйте `.mockReturnValue()` или `.mockResolvedValue()` чтобы задать возвращаемые значения моковым методам репозитория.
2. В e2e тестах используйте `repository.clear()` для очистки базы данных перед каждым тестом.
3. Тесты должны быть независимыми друг от друга.
4. Используйте `beforeEach()` и `afterEach()` хуки для настройки и очистки тестового окружения.
